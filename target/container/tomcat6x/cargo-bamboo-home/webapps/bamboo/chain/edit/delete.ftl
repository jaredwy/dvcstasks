[#-- @ftlvariable name="action" type="com.atlassian.bamboo.ww2.actions.plan.DeletePlan" --]
[#-- @ftlvariable name="" type="com.atlassian.bamboo.ww2.actions.plan.DeletePlan" --]

[#if plan.type.equals('JOB')]
    [#assign title=action.getText('job.delete')]
[#else]
    [#assign title=action.getText('plan.delete.title')]
[/#if]

<title>${title}</title>
<div class="section">
    [#if plan.isActive()]
        [@ww.form title='${title}'
                      action='stopPlan' namespace='/build/admin'
                      submitLabelKey='global.buttons.confirm'
                      cancelUri='/browse/${plan.key}' ]
            [@ww.hidden name="planKey" value="${plan.key}"/]
            [@ui.messageBox type="warning"]
                [#if plan.type.equals('CHAIN')]
                    [@ww.text name='chain.delete.stop']
                        [@ww.param]'${plan.getName()}'[/@ww.param]
                        [@ww.param value='${action.getNumberOfExecutions(plan.planKey)}'/]
                    [/@ww.text]
                [#elseif plan.type.equals('JOB')]
                    [@ww.text name='job.delete.stop']
                        [@ww.param]${plan.getName()}[/@ww.param]
                        [@ww.param]${plan.parent.getName()}[/@ww.param]
                        [@ww.param value='${action.getNumberOfExecutions(plan.getParent().getPlanKey())}'/]
                    [/@ww.text]
                [/#if]
            [/@ui.messageBox]
        [/@ww.form]
    [#else]
        [@ww.form title='${title}'
                      action='deleteChain!doDelete' namespace='/chain/admin'
                      submitLabelKey='global.buttons.confirm'
                      cancelUri='/browse/${plan.key}' ]
            [@ww.hidden name="buildKey"/]
            [@ww.hidden name="returnUrl" /]
            [@ui.messageBox type="warning"]
                [#if plan.type.equals('CHAIN')]
                    [@ww.text name='chain.delete.description']
                        [@ww.param]${plan.getName()}[/@ww.param]
                        [@ww.param value='${plan.stages.size()}'/]
                        [@ww.param value='${plan.getJobCount()}'/]
                    [/@ww.text]
                [#elseif plan.type.equals('JOB')]
                    [@ww.text name='job.delete.description']
                        [@ww.param]${plan.getName()}[/@ww.param]
                    [/@ww.text]
                [/#if]
            [/@ui.messageBox]
            [#if jobsContainingInvalidSubscriptions?has_content ]
                [#import "/fragments/artifact/artifacts.ftl" as artifacts/]
                [@ww.text name='job.remove.confirm.subscriptions' id='confirmationMsg'/]
                [@artifacts.displaySubscribersAndProducersByStage subscribedJobs=jobsContainingInvalidSubscriptions dependenciesDeletionMessage=confirmationMsg headerWeight='h3'/]
            [/#if]
        [/@ww.form]
    [/#if]
</div>