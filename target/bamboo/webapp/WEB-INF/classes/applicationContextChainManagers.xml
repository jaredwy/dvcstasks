<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:plugin="http://atlassian.com/schema/spring/plugin"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://atlassian.com/schema/spring/plugin http://atlassian.com/schema/spring/plugin.xsd">

    <!-- Managers -->

    <bean id="chainStateFactory" class="com.atlassian.bamboo.chains.ChainStateFactoryImpl">
        <constructor-arg ref="planManager"/>
    </bean>

    <bean id="chainResultManager" parent="txReadWriteProxy">
      <property name="target">
        <bean class="com.atlassian.bamboo.chains.ChainResultManagerImpl">
          <constructor-arg ref="buildResultsSummaryManager"/>
          <constructor-arg ref="buildExecutionManagerLimitedConcurrencyCaller"/>
          <constructor-arg ref="errorUpdateHandler"/>
          <constructor-arg ref="textProvider"/>
          <constructor-arg ref="planManager"/>
        </bean>
      </property>
      <property name="preInterceptors">
        <list>
          <bean class="com.atlassian.bamboo.author.AuthorCreatorServiceInterceptor">
            <constructor-arg ref="authorCreatorService"/>
          </bean>
        </list>
      </property>
    </bean>

  <alias name="chainExecutionManager" alias="chainExecutionUpdateManager"/>

  <bean id="chainExecutionManager" class="com.atlassian.bamboo.chains.ChainExecutionManagerImpl" lazy-init="true">
        <constructor-arg ref="planStatePersisterService"/>
        <constructor-arg ref="jobExecutionManager"/>
        <constructor-arg ref="chainResultManager"/>
        <constructor-arg ref="chainStateFactory"/>
        <constructor-arg ref="buildContextFactory"/>
        <constructor-arg ref="eventManager"/>
        <constructor-arg ref="chainPluginSupport"/>
        <constructor-arg ref="errorUpdateHandler"/>
        <constructor-arg ref="authorCreatorService" />
    </bean>

    <!-- ChainExecutionManager dependencies -->

    <bean id="jobExecutionManager" class="com.atlassian.bamboo.chains.JobExecutionManagerImpl">
        <constructor-arg ref="buildExecutionManager"/>
        <constructor-arg ref="stopBuildManager"/>
        <constructor-arg ref="resultsSummaryManager"/>
    </bean>

    <bean id="buildContextFactory" class="com.atlassian.bamboo.chains.BuildContextFactoryImpl">
        <constructor-arg ref="triggerReasonManager"/>
        <constructor-arg ref="changeDetectionManager"/>
        <constructor-arg ref="artifactDefinitionManager"/>
        <constructor-arg ref="artifactSubscriptionManager"/>
        <constructor-arg ref="variableDefinitionManager"/>
    </bean>

    <bean id="chainPluginSupport" class="com.atlassian.bamboo.chains.ChainPluginSupportImpl" lazy-init="true">
      <constructor-arg ref="planManager"/>
      <constructor-arg ref="buildResultsSummaryManager"/>
      <constructor-arg ref="pluginAccessor"/>
      <constructor-arg ref="errorUpdateHandler"/>
    </bean>
  
    <bean id="stageStatusHelper" class="com.atlassian.bamboo.chains.StageStatusHelperImpl" plugin:available="true">
      <constructor-arg ref="textProvider"/>
    </bean>
</beans>
