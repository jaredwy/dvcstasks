<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:plugin="http://atlassian.com/schema/spring/plugin"
       xsi:schemaLocation="
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
       http://atlassian.com/schema/spring/plugin http://atlassian.com/schema/spring/plugin.xsd">

  <bean id="upgradeManager" class="com.atlassian.bamboo.upgrade.UpgradeManagerImpl" lazy-init="true">
    <constructor-arg ref="applicationConfig" />
    <constructor-arg value="upgrades.xml" />
    <property name="buildResultsIndexer" ref="buildResultsIndexer" />
    <property name="systemStatisticsBean" ref="systemStatisticsBean" />
    <property name="upgradeUtilityBean" ref="upgradeUtilityBean" />
    <property name="textProvider" ref="textProvider" />
  </bean>

  <bean id="errorHandler" class="com.atlassian.bamboo.logger.DefaultErrorHandler" lazy-init="true" plugin:available="true">
    <property name="planManager" ref="planManager" />
    <property name="agentContext" ref="agentContext" />
    <property name="eventManager" ref="eventManager" />
    <property name="buildResultsSummaryManager" ref="buildResultsSummaryManager" />
  </bean>
  <alias name="errorHandler" alias="errorUpdateHandler" />
  <alias name="errorHandler" alias="errorAccessor" />

  <bean name="aggregatedChainErrorAccessor" class="com.atlassian.bamboo.logger.AggregatedChainErrorAccessor">
    <constructor-arg ref="errorHandler"/>
    <constructor-arg ref="planManager"/>
    <constructor-arg ref="resultsSummaryManager"/>
  </bean>

  <bean id="adminErrorHandler" class="com.atlassian.bamboo.logger.AdminErrorHandlerImpl" lazy-init="true">
  </bean>

  <bean id="exceptionTranslator" class="com.atlassian.bamboo.ww2.actions.error.ExceptionTranslatorImpl" lazy-init="true" plugin:available="true">
  </bean>

  <bean id="htmlUtils" class="com.atlassian.bamboo.util.HtmlUtils">
  </bean>


  <bean id="cookieCutter" class="com.atlassian.bamboo.build.CookieCutterImpl" plugin:available="true">
  </bean>

  <bean id="capabilityHelper" class="com.atlassian.bamboo.v2.build.agent.capability.CapabilityHelper">
    <constructor-arg ref="pluginAccessor"/>
  </bean>

  <bean id="planConfigurationUIPluginHelper" class="com.atlassian.bamboo.plugin.web.PlanConfigurationPluginUIHelperImpl">
    <constructor-arg ref="pluginAccessor"/>
  </bean>

  <bean id="systemStatisticsBean" class="com.atlassian.bamboo.configuration.DefaultSystemStatisticsBean" lazy-init="true" scope="prototype">
    <constructor-arg ref="planManager" />
    <constructor-arg ref="buildResultsSummaryManager" />
    <constructor-arg ref="buildResultsIndexer" />
  </bean>


  <bean id="buildExpiryBean" class="com.atlassian.bamboo.build.expiry.BuildExpiryBean">
    <constructor-arg  ref="planManager" />
    <constructor-arg ref="resultsSummaryManager" />
    <constructor-arg ref="administrationConfigurationManager" />
    <constructor-arg ref="labelDao" />
  </bean>

  <bean id="filterController" class="com.atlassian.bamboo.build.FilterController">
  </bean>

  <bean id="cacheManager" class="bucket.cache.ehcache.EhcacheManager">
    <!--<property name="nonFlushableCaches">-->
      <!--<list>-->
        <!--<value>com.atlassian.confluence.rpc.auth.TokenAuthenticationManager.tokens</value>-->
      <!--</list>-->
    <!--</property>-->
  </bean>

  <bean id="templateRenderer" class="com.atlassian.bamboo.ww2.BambooFreemarkerManager" plugin:available="true">
    <property name="homeLocator" ref="homeLocator" />
    <property name="pluginAccessor" ref="pluginAccessor"/>
    <property name="i18nBeanFactory" ref="i18nBeanFactory"/>
  </bean>

  <bean id="concurrentCacheStorage" class="freemarker.cache.ConcurrentStrongCacheStorage"/>

  <bean id="bambooMailer" class="com.atlassian.bamboo.mail.BambooMailer">
    <property name="templateRenderer" ref="templateRenderer" />
  </bean>

  <bean id="resetableHiLoGeneratorHelper" class="com.atlassian.bamboo.migration.ResetableHiLoGeneratorHelper" >
    <constructor-arg ref="sessionFactory" />
  </bean>

  <!-- An abstract template for a class requiring transactions for -->
  <bean id="txWriteProxy" class="org.springframework.transaction.interceptor.TransactionProxyFactoryBean" abstract="true">
    <property name="transactionManager" ref="transactionManager"/>
    <property name="transactionAttributes">
      <props>
        <prop key="*">PROPAGATION_REQUIRED</prop>
      </props>
    </property>
  </bean>

  <bean id="artifactManager" class="com.atlassian.bamboo.build.artifact.LocalArtifactManager">
      <constructor-arg ref="buildLoggerManager"/>
      <constructor-arg ref="buildResultsSummaryManager"/>
      <constructor-arg ref="buildDirectoryManager"/>
      <constructor-arg ref="artifactSubscriptionManager"/>
  </bean>

  <bean id="artifactLinkManager" class="com.atlassian.bamboo.build.artifact.DefaultArtifactLinkManager">
    <constructor-arg ref="artifactLinkDao"/>
  </bean>

  <bean id="buildLogFileAccessorFactory" class="com.atlassian.bamboo.build.logger.BuildLogFileAccessorFactoryImpl"/>

  <bean id="bambooVersion" class="com.atlassian.bamboo.util.BuildUtils" factory-method="getVersionAndBuild" scope="prototype"/>
  <bean id="bambooVersionNumber" class="com.atlassian.bamboo.util.BuildUtils" factory-method="getCurrentVersion" scope="prototype"/>

  <bean id="availableBulkActions" class="org.springframework.beans.factory.config.ListFactoryBean">
    <property name="sourceList">
      <list>
        <bean class="com.atlassian.bamboo.ww2.actions.admin.bulk.AddNotificationBulkAction">
          <constructor-arg ref="planManager" />
          <constructor-arg ref="notificationManager"/>
        </bean>
        <bean class="com.atlassian.bamboo.ww2.actions.admin.bulk.DeleteAllNotificationBulkAction">
          <constructor-arg ref="planManager" />
        </bean>
        <bean class="com.atlassian.bamboo.ww2.actions.admin.bulk.UpdateSvnUrlBulkAction">
        </bean>
        <bean class="com.atlassian.bamboo.ww2.actions.admin.bulk.UpdateSvnCredentialsBulkAction">
        </bean>
        <bean class="com.atlassian.bamboo.ww2.actions.admin.bulk.UpdateCvsRootCredentialsBulkAction">
        </bean>
        <bean class="com.atlassian.bamboo.ww2.actions.admin.bulk.UpdateCvsModuleBulkAction">
          <constructor-arg ref="repositoryManager"/>
        </bean>
        <bean class="com.atlassian.bamboo.ww2.actions.admin.bulk.UpdateWebUrlBulkAction">
          <constructor-arg ref="webRepositoryViewerManager"/>
        </bean>
        <bean class="com.atlassian.bamboo.ww2.actions.admin.bulk.ManualBuildBulkAction">
          <constructor-arg ref="planManager" />
        </bean>
      </list>
    </property>
  </bean>
  
  <!-- Cleanup helper class used by BambooContainer on start up -->
  <bean id="pendingBuildResultsCleanup" parent="txReadWriteProxy">
    <property name="target">
      <bean class="com.atlassian.bamboo.container.startup.PendingBuildResultsCleanupImpl">
        <constructor-arg ref="planManager"/>
        <constructor-arg ref="buildResultsSummaryManager"/>
      </bean>
    </property>
  </bean>

  <bean id="rememberMeConfiguration" class="com.atlassian.seraph.service.rememberme.DefaultRememberMeConfiguration"/>

  <bean id="upgradeUtilityBean" class="com.atlassian.bamboo.upgrade.UpgradeUtilityBean"/>

</beans>
